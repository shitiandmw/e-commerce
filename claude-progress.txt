## 测试进度记录

### 2026-02-16 Session - 弹窗管理模块 (F033-F040)

测试功能: F033-F040 弹窗管理模块（共 8 个功能）

#### 测试结果
- F033 弹窗列表查询 ✅ 直接通过
- F034 弹窗创建 ✅ 直接通过
- F035 弹窗编辑 ✅ 直接通过
- F036 弹窗删除 ✅ 直接通过
- F037 弹窗触发类型配置 ✅ 直接通过
- F038 弹窗频率配置 ✅ 直接通过
- F039 弹窗目标页面配置 ✅ 直接通过
- F040 弹窗素材选择 ✅ 直接通过

#### 总结
- 8/8 功能全部通过，无需代码修复
- 弹窗管理模块功能完整：CRUD、触发类型配置、频率配置、目标页面配置、媒体素材选择
- 所有功能通过浏览器 UI 端到端验证

### 2026-02-16 Session - Banner 管理模块 (F041-F051)

测试功能: F041-F051 Banner 管理模块（共 11 个功能）

#### 测试结果
| Feature | 描述 | 状态 |
|---------|------|------|
| F041 | Banner位列表查询 | ✅ PASS |
| F042 | Banner位创建 | ✅ PASS |
| F043 | Banner位编辑 | ✅ PASS |
| F044 | Banner位删除 | ✅ PASS |
| F045 | Banner项列表查询 | ✅ PASS |
| F046 | Banner项创建 | ✅ PASS (修复了2个bug) |
| F047 | Banner项编辑 | ✅ PASS |
| F048 | Banner项删除 | ✅ PASS |
| F049 | Banner项时间窗配置 | ✅ PASS |
| F050 | Banner项启用禁用 | ✅ PASS |
| F051 | Banner项排序配置 | ✅ PASS |

#### 修复的 Bug
1. `src/api/middlewares.ts`: `GetBannerItemsSchema` 缺少 `slot_id` 字段，导致前端按 slot 过滤 banner items 时报 "Unrecognized fields" 错误
2. `src/api/admin/banner-items/validators.ts`: `PostAdminCreateBannerItem` 的 `starts_at`、`ends_at`、`title`、`subtitle`、`link_url` 字段缺少 `.nullable()`，导致前端发送 null 值时验证失败

#### 总结
- 11/11 功能全部通过
- 修复了 2 个后端验证 bug
- 所有功能通过浏览器 UI 端到端验证

### 2026-02-16 Session - F088~F090 媒体管理模块

测试功能:
- F088 媒体列表接口查询 ✅ 直接通过
- F089 媒体MIME类型识别 ✅ 直接通过
- F090 媒体分页查询 ✅ 直接通过

测试详情:
- F088: GET /admin/uploads API 正确返回文件列表，包含 id/url/name/size/mime_type/created_at 字段，UI 正确显示网格/列表视图
- F089: 验证了 6 种 MIME 类型识别（png→image/png, jpg→image/jpeg, csv→text/csv, pdf→application/pdf, svg→image/svg+xml, txt→text/plain），UI 根据类型显示不同图标
- F090: 验证了分页参数 offset/limit 正确工作，返回 count 总数，边界情况（超出范围返回空数组）处理正确

完成状态: F088-F090 全部通过

### 2026-02-16 Session - 商品管理模块 (F091-F096)

| Feature | 名称 | 状态 | 备注 |
|---------|------|------|------|
| F091 | 商品创建（含变体） | ✅ PASS | 创建商品 F091Test，含默认变体 |
| F092 | 商品编辑 | ✅ PASS | 修改标题为 F091Test-Edited，添加副标题 |
| F093 | 商品分类绑定 | ✅ PASS | 绑定 Shirts 分类，修复了分类绑定需使用独立 API 的问题 |
| F094 | 商品品牌绑定 | ✅ PASS | 绑定 Test Brand Edited，修复了 fields 参数需用 *brand 的问题 |
| F095 | 商品标签绑定 | ✅ PASS | 绑定 测试标签F009，通过 UI 选择并 API 验证 |
| F096 | 商品SEO保存 | ✅ PASS | 填写 meta_title/meta_description/keywords，保存到 metadata.seo 并验证回显 |

#### 代码修复记录
- `use-products.ts`: fields 参数从 `+categories,+brand,+custom_tags` 改为 `*categories,*brand,*custom_tags`（Medusa v2 自定义模块链接需要 * 前缀）
- `use-products.ts`: 新增 `useLinkProductCategory` 和 `useUnlinkProductCategory` hooks
- `product-form.tsx`: 编辑模式下分类/品牌/标签绑定改用独立 API 端点而非产品更新 API

### 2026-02-16 Session - 订单/客户/库存/配送/促销/看板/设置 (F097-F108)

测试结果: 12/12 全部通过

F097 订单列表查询      ✅ PASS
F098 订单详情查看      ✅ PASS
F099 客户列表查询      ✅ PASS
F100 客户详情查看      ✅ PASS
F101 库存列表查询      ✅ PASS
F102 库存调整          ✅ PASS
F103 配送配置页可用    ✅ PASS
F104 促销列表查询      ✅ PASS
F105 促销创建          ✅ PASS (修复了 Zod schema 验证问题)
F106 促销编辑          ✅ PASS
F107 数据看板加载      ✅ PASS
F108 设置页加载        ✅ PASS

修复的 Bug:
1. promotion-form.tsx: allocation 字段 Zod schema 不接受空字符串，导致表单提交静默失败
   - 修改: z.enum(["each","across"]).optional() → z.union([z.enum(["each","across"]), z.literal("")]).optional()
   - 同时确保 API payload 始终发送 allocation 和 max_quantity
